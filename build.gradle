apply plugin: 'java'
allprojects  {
  apply plugin: 'maven'
  group = 'com.kinvey'
  version = '2.9.4'
  description = "The Kinvey SDK makes it easy to write Android and Java apps with Kinvey"
}

subprojects {
  sourceCompatibility = 1.5
  targetCompatibility = 1.5

  
  repositories {
    mavenLocal()
    
    maven { 
      credentials {
        username System.properties['mvn_username']
        password System.properties['mvn_password']
      }
      url "https://build.kinvey.com/nexus/content/repositories/thirdparty" 
    }
    maven { url "https://oss.sonatype.org/content/repositories/releases/" }
    maven { url "file:/Users/edward/.m2/repository/" }
    maven { url "http://repo1.maven.org/maven2" }
    maven { url "https://oss.sonatype.org/content/repositories/snapshots" }
  }

  configurations.all {
  }
}



//task release will do the following:

//run clean
//run build
//run copyAndroid
//run copyJava
//run zipAndroid
//run zipJava
//run aarAndroid
//run docgen

task makeAndroidJar(type: Copy) << {
    from('android-lib/build/intermediates/bundles/release/')
    into('android-lib/build/outputs/')
    include('classes.jar')
    rename ('classes.jar', 'ProjectName.jar')
}

task copyAndroid(type: Copy) << {
  from 'android-lib/build/libs'
  from 'java-api-core/build/libs'
  into 'release/build/android'
}

task copyJava(type: Copy) << {
  from 'java-lib/build/libs'
  from 'java-api-core/build/libs'
  into 'release/build/nativejava'
}

task zipAndroid(type: Zip) << {
    from 'release/build/android'
    from 'release/dependencies'
    baseName = 'kinvey-android'
    destinationDir = file('release/zipped')
    
    println zipAndroid.archiveName
    println relativePath(zipAndroid.destinationDir)
    println relativePath(zipAndroid.archivePath)
}


task zipJava(type: Zip) << {
    from 'release/build/java'
    from 'release/dependencies'
    baseName = 'kinvey-java'
    destinationDir = file('release/zipped')
    
}

task docgen(){}

task release(dependsOn: ['clean', 'build', 'makeAndroidJar', 'copyAndroid', 'copyJava', 'zipAndroid', 'zipJava', 'docgen']){
    description 'Performs the complete release process (except for bumping version number!)'
}

build.mustRunAfter clean
makeAndroidJar.mustRunAfter build
copyAndroid.mustRunAfter makeAndroidJar
copyJava.mustRunAfter copyAndroid
zipAndroid.mustRunAfter copyJava
zipJava.mustRunAfter zipAndroid
docgen.mustRunAfter zipJava